<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Permuta de Serviço Oficial</title>
    <!-- Inclui o Tailwind CSS para estilização moderna e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inclui a biblioteca de ícones Lucide para uma interface mais visual -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000080; /* Um cinza mais suave para o fundo */
        }
        /* Estilos para a impressão e geração de PDF */
        @media print {
            body { background-color: white; margin: 0; padding: 0; }
            .no-print { display: none; }
            .printable-form { border: none !important; box-shadow: none !important; padding: 0 !important; margin: 0 !important; max-width: 100% !important; }
            input[type="text"], input[type="date"], input[type="tel"] { border: none !important; border-bottom: 1px solid #ccc !important; padding: 2px 0 !important; -color: white !important; }
        }
        .input-error { border-color: #ef4444 !important; --tw-ring-color: #ef4444 !important; }
        .shadow-3d { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

        /* Estilos para o Calendário Interativo */
        .calendar-day { transition: all 0.2s ease-in-out; }
        .calendar-day:not(.disabled):hover { background-color: #dbeafe; color: #1d4ed8; }
        .day-selected { background-color: #2563eb !important; color: white !important; font-weight: bold; }
        .day-in-range { background-color: #93c5fd; color: #1e40af; }
        .day-disabled { color: #9ca3af; cursor: not-allowed; }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <!-- Alerta Customizado -->
    <div id="custom-alert" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-[9999] p-4">
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-md w-full text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4">
                <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2" id="alert-title"></h3>
            <p class="text-gray-600 mb-6" id="alert-message"></p>
            <button onclick="closeCustomAlert()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-300">OK</button>
        </div>
    </div>

    <!-- Container Principal do Formulário -->
    <div class="printable-form bg-white rounded-2xl shadow-3d p-6 md:p-10 max-w-5xl mx-auto">
        
        <!-- Cabeçalho -->
        <header class="text-center mb-10">
            <img src="https://pm.ssp.ma.gov.br/wp-content/uploads/2023/05/BRASAO-SD-RAYOL-e1683655730963.png" alt="Brasão da Polícia Militar do Maranhão" class="w-20 h-auto mx-auto mb-4 no-print">
            <div class="border-y-2 border-gray-200 py-4">
                <h1 class="text-lg font-bold tracking-wide text-gray-700">ESTADO DO MARANHÃO</h1>
                <p class="text-sm text-gray-500">SECRETARIA DE SEGURANÇA PÚBLICA</p>
                <p class="text-sm text-gray-500">10º BATALHÃO DA POLÍCIA MILITAR - 2ª CIA</p>
            </div>
            <h2 class="text-2xl sm:text-3xl font-extrabold text-gray-800 mt-8">Formulário de Permuta de Serviço</h2>
            <p class="text-center text-lg font-semibold text-gray-600 -mt-1 mb-8">TURIAÇU</p>
        </header>

        <!-- Seção de Identificação dos Policiais -->
        <div class="grid md:grid-cols-2 gap-8 mb-8">
            <!-- Card PM Substituído -->
            <div class="p-6 bg-gray-50 rounded-xl border border-gray-200">
                <h3 class="text-lg font-bold text-gray-800 mb-4 uppercase tracking-wider">1. PM Substituído</h3>
                <div class="space-y-4">
                    <div>
                        <label for="pmSubstituidoNome" class="text-sm font-medium text-gray-600 block mb-1">Nome:</label>
                        <select id="pmSubstituidoNome" class="w-full p-3 border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 rounded-lg">
                            <option value="" disabled selected>Selecione um PM</option>
                        </select>
                        <p id="pmSubstituidoNomeWarning" class="text-xs text-red-600 mt-1 hidden">Campo obrigatório.</p>
                    </div>
                    <div>
                        <label for="pmSubstituidoIdentificacao" class="text-sm font-medium text-gray-600 block mb-1">ID:</label>
                        <input type="tel" id="pmSubstituidoIdentificacao" placeholder="ID será preenchido ou pode ser digitado" pattern="\d*" class="w-full p-3 border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 rounded-lg">
                        <p id="pmSubstituidoIdentificacaoWarning" class="text-xs text-red-600 mt-1 hidden">Campo obrigatório.</p>
                    </div>
                </div>
            </div>
            <!-- Card PM Substituto -->
            <div class="p-6 bg-gray-50 rounded-xl border border-gray-200">
                <h3 class="text-lg font-bold text-gray-800 mb-4 uppercase tracking-wider">2. PM Substituto</h3>
                <div class="space-y-4">
                    <div>
                        <label for="pmSubstitutoNome" class="text-sm font-medium text-gray-600 block mb-1">Nome:</label>
                        <select id="pmSubstitutoNome" class="w-full p-3 border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 rounded-lg">
                            <option value="" disabled selected>Selecione um PM</option>
                        </select>
                        <p id="pmSubstitutoNomeWarning" class="text-xs text-red-600 mt-1 hidden">Campo obrigatório.</p>
                    </div>
                    <div>
                        <label for="pmSubstitutoIdentificacao" class="text-sm font-medium text-gray-600 block mb-1">ID:</label>
                        <input type="tel" id="pmSubstitutoIdentificacao" placeholder="ID será preenchido ou pode ser digitado" pattern="\d*" class="w-full p-3 border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 rounded-lg">
                        <p id="pmSubstitutoIdentificacaoWarning" class="text-xs text-red-600 mt-1 hidden">Campo obrigatório.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção de Datas -->
        <div class="mb-8 p-6 bg-gray-50 rounded-xl border border-gray-200">
            <h3 class="text-lg font-bold text-gray-800 mb-4 uppercase tracking-wider">3. Datas da Permuta</h3>
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Calendário para Serviço Permutado -->
                <div class="flex flex-col">
                    <label class="text-base font-semibold text-gray-700 mb-2">Data(s) do Serviço Permutado:</label>
                    <p class="text-xs text-gray-500 mb-3">Clique para selecionar um intervalo de até 3 dias.</p>
                    <div id="calendar-container-service" class="w-full max-w-sm mx-auto bg-white p-4 rounded-lg border"></div>
                    <input type="hidden" id="dataServicoPermutadoInicio">
                    <input type="hidden" id="dataServicoPermutadoFim">
                    <p id="dataServicoPermutadoWarning" class="text-sm text-red-600 mt-3 hidden font-semibold text-center">É necessário selecionar um intervalo de datas.</p>
                </div>
                <!-- Datas do Pagamento -->
                <div class="flex flex-col">
                     <div class="flex items-center justify-between mb-2">
                        <label class="text-base font-semibold text-gray-700">Data(s) do Pagamento:</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="noPagamentoCheckbox" class="form-checkbox h-4 w-4 rounded text-blue-600 border-gray-400 focus:ring-blue-500">
                            <label for="noPagamentoCheckbox" class="text-xs text-gray-600 ml-2 cursor-pointer">Não há pagamento</label>
                        </div>
                    </div>
                    <div id="payment-fields-container">
                        <p class="text-xs text-gray-500 mb-3">Clique para selecionar um intervalo de até 3 dias.</p>
                        <div id="calendar-container-payment" class="w-full max-w-sm mx-auto bg-white p-4 rounded-lg border"></div>
                        <input type="hidden" id="dataPagamentoServicoInicio">
                        <input type="hidden" id="dataPagamentoServicoFim">
                        <p id="dataPagamentoWarning" class="text-sm text-red-600 mt-3 hidden font-semibold text-center">É necessário selecionar um intervalo de datas.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Botões de Ação -->
        <div class="no-print flex flex-col md:flex-row justify-center items-center gap-4 mt-10 border-t-2 border-gray-100 pt-8">
            <button onclick="printForm()" class="w-full md:w-auto bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 flex items-center justify-center gap-2">
                <i data-lucide="check-circle" class="w-5 h-5"></i>
                <span>Concluir e Imprimir</span>
            </button>
            <button onclick="signWithGovBr()" class="w-full md:w-auto bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300 flex items-center justify-center gap-2">
                <i data-lucide="pen-square" class="w-5 h-5"></i>
                <span>Ir para o GOV.BR</span>
            </button>
        </div>
    </div>

    <script>
        // Inicializa a biblioteca de ícones Lucide
        lucide.createIcons();
        
        // --- LÓGICA DO ALERTA CUSTOMIZADO ---
        function showCustomAlert(title, message) {
            document.getElementById('alert-title').textContent = title;
            document.getElementById('alert-message').textContent = message;
            document.getElementById('custom-alert').classList.remove('hidden');
        }
        window.closeCustomAlert = function() {
            document.getElementById('custom-alert').classList.add('hidden');
        };
        
        // --- LÓGICA DE SELEÇÃO E PREENCHIMENTO DOS PMs ---
        const pmData = {
            "Cb Pm 626/14 Coriolano": "N/A", "Sd Pm 473/16 André": "849351", "Sd Pm 408/18 Ribeiro": "N/A",
            "Sd Pm 424/18 Rodrigues": "N/A", "Sd Pm 885/18 Albert": "N/A", "Sd Pm 502/22 Sales": "869293",
            "SD PM 572/22 Theodosio": "871896", "Sd Pm 457/24 Eduardo Silva": "869987"
        };
        
        const pmSubstituidoNomeSelect = document.getElementById('pmSubstituidoNome');
        const pmSubstituidoIdentificacaoInput = document.getElementById('pmSubstituidoIdentificacao');
        const pmSubstitutoNomeSelect = document.getElementById('pmSubstitutoNome');
        const pmSubstitutoIdentificacaoInput = document.getElementById('pmSubstitutoIdentificacao');

        function fillId(selectElement, targetInput) {
            const selectedName = selectElement.value;
            targetInput.value = pmData[selectedName] || '';
            targetInput.dispatchEvent(new Event('input')); // Dispara validação
        }

        function populatePmSelects() {
            const selects = [pmSubstituidoNomeSelect, pmSubstitutoNomeSelect];
            selects.forEach(select => {
                for (const name in pmData) {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    select.appendChild(option);
                }
            });
        }
        
        pmSubstituidoNomeSelect.addEventListener('change', () => fillId(pmSubstituidoNomeSelect, pmSubstituidoIdentificacaoInput));
        pmSubstitutoNomeSelect.addEventListener('change', () => fillId(pmSubstitutoNomeSelect, pmSubstitutoIdentificacaoInput));

        // --- LÓGICA GENÉRICA DO CALENDÁRIO ---
        
        // Objetos de estado para cada calendário
        let serviceCalendarState = {
            currentDate: new Date(), selectedStartDate: null, selectedEndDate: null,
            containerId: 'calendar-container-service', startDateInputId: 'dataServicoPermutadoInicio',
            endDateInputId: 'dataServicoPermutadoFim', warningId: 'dataServicoPermutadoWarning'
        };
        let paymentCalendarState = {
            currentDate: new Date(), selectedStartDate: null, selectedEndDate: null,
            containerId: 'calendar-container-payment', startDateInputId: 'dataPagamentoServicoInicio',
            endDateInputId: 'dataPagamentoServicoFim', warningId: 'dataPagamentoWarning'
        };

        function renderCalendar(state) {
            const container = document.getElementById(state.containerId);
            const month = state.currentDate.getMonth();
            const year = state.currentDate.getFullYear();
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            
            let calendarHTML = `
                <div class="flex justify-between items-center mb-4">
                    <button class="prev-month p-2 rounded-full hover:bg-gray-100"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                    <h4 class="font-bold text-lg">${monthNames[month]} ${year}</h4>
                    <button class="next-month p-2 rounded-full hover:bg-gray-100"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                </div>
                <div class="grid grid-cols-7 gap-1 text-center text-xs font-semibold text-gray-500 mb-2">
                    <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div>
                </div>
                <div class="calendar-days grid grid-cols-7 gap-1">`;

            for (let i = 0; i < firstDay; i++) { calendarHTML += `<div></div>`; }

            for (let i = 1; i <= lastDate; i++) {
                const dayDate = new Date(year, month, i);
                let classes = 'calendar-day cursor-pointer h-9 w-9 flex items-center justify-center rounded-full';
                if (dayDate < today && dayDate.toDateString() !== today.toDateString()) { classes += ' day-disabled'; }
                if (state.selectedStartDate && dayDate.getTime() === state.selectedStartDate.getTime()) { classes += ' day-selected'; } 
                else if (state.selectedEndDate && dayDate.getTime() === state.selectedEndDate.getTime()) { classes += ' day-selected'; } 
                else if (state.selectedStartDate && state.selectedEndDate && dayDate > state.selectedStartDate && dayDate < state.selectedEndDate) { classes += ' day-in-range'; }
                calendarHTML += `<div class="${classes}" data-date="${dayDate.toISOString().split('T')[0]}">${i}</div>`;
            }

            calendarHTML += `</div>`;
            container.innerHTML = calendarHTML;
            lucide.createIcons();

            container.querySelector('.prev-month').addEventListener('click', () => { state.currentDate.setMonth(state.currentDate.getMonth() - 1); renderCalendar(state); });
            container.querySelector('.next-month').addEventListener('click', () => { state.currentDate.setMonth(state.currentDate.getMonth() + 1); renderCalendar(state); });
            container.querySelector('.calendar-days').addEventListener('click', (e) => handleDayClick(e, state));
        }

        function handleDayClick(e, state) {
            if (!e.target.dataset.date || e.target.classList.contains('day-disabled')) return;
            const clickedDate = new Date(e.target.dataset.date + 'T00:00:00');

            if (!state.selectedStartDate || (state.selectedStartDate && state.selectedEndDate)) {
                state.selectedStartDate = clickedDate;
                state.selectedEndDate = null;
            } else {
                state.selectedEndDate = clickedDate;
                if (state.selectedEndDate < state.selectedStartDate) { [state.selectedStartDate, state.selectedEndDate] = [state.selectedEndDate, state.selectedStartDate]; }
                const diffTime = Math.abs(state.selectedEndDate - state.selectedStartDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays > 2) {
                    showCustomAlert('Intervalo Inválido', 'Você pode selecionar no máximo 3 dias consecutivos.');
                    state.selectedStartDate = clickedDate;
                    state.selectedEndDate = null;
                }
            }
            const startDateValue = state.selectedStartDate ? state.selectedStartDate.toISOString().split('T')[0] : '';
            const endDateValue = state.selectedEndDate ? state.selectedEndDate.toISOString().split('T')[0] : startDateValue;
            
            document.getElementById(state.startDateInputId).value = startDateValue;
            document.getElementById(state.endDateInputId).value = endDateValue;
            
            validateDateSelection(state);
            renderCalendar(state);
        }

        // --- LÓGICA DO PAGAMENTO CHECKBOX ---
        const noPagamentoCheckbox = document.getElementById('noPagamentoCheckbox');
        const paymentContainer = document.getElementById('payment-fields-container');
        noPagamentoCheckbox.addEventListener('change', function() {
            paymentContainer.classList.toggle('hidden', this.checked);
            if (this.checked) {
                paymentCalendarState.selectedStartDate = null;
                paymentCalendarState.selectedEndDate = null;
                document.getElementById(paymentCalendarState.startDateInputId).value = '';
                document.getElementById(paymentCalendarState.endDateInputId).value = '';
                renderCalendar(paymentCalendarState);
                validateDateSelection(paymentCalendarState);
            }
        });

        // --- VALIDAÇÃO GERAL ---
        function validateField(fieldId, warningId) {
            const field = document.getElementById(fieldId);
            const isValid = field.value.trim() !== '';
            field.classList.toggle('input-error', !isValid);
            document.getElementById(warningId).classList.toggle('hidden', isValid);
            return isValid;
        }

        function validateDateSelection(state) {
            const startDateInput = document.getElementById(state.startDateInputId);
            const warning = document.getElementById(state.warningId);
            const isValid = startDateInput.value.trim() !== '';
            warning.classList.toggle('hidden', isValid);
            return isValid;
        }
        
        const requiredFields = [
            { id: 'pmSubstituidoNome', warningId: 'pmSubstituidoNomeWarning' },
            { id: 'pmSubstituidoIdentificacao', warningId: 'pmSubstituidoIdentificacaoWarning' },
            { id: 'pmSubstitutoNome', warningId: 'pmSubstitutoNomeWarning' },
            { id: 'pmSubstitutoIdentificacao', warningId: 'pmSubstitutoIdentificacaoWarning' },
        ];
        requiredFields.forEach(field => {
            document.getElementById(field.id).addEventListener('input', () => validateField(field.id, field.warningId));
        });

        function validateAllFields() {
            let isValid = true;
            requiredFields.forEach(field => { isValid = validateField(field.id, field.warningId) && isValid; });
            isValid = validateDateSelection(serviceCalendarState) && isValid;
            
            if (!noPagamentoCheckbox.checked) {
                isValid = validateDateSelection(paymentCalendarState) && isValid;
            }
            
            if (!isValid) { showCustomAlert('Campos Incompletos', 'Por favor, preencha todos os campos obrigatórios.'); }
            return isValid;
        }
        
        // --- LÓGICA DE IMPRESSÃO ---
        function formatarDataRange(startDateStr, endDateStr) {
            if (!startDateStr || !endDateStr) return '';
            const dates = [];
            let currentDate = new Date(startDateStr + 'T00:00:00');
            const finalDate = new Date(endDateStr + 'T00:00:00');
            while (currentDate <= finalDate) {
                dates.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            if (dates.length === 0) return '';
            if (dates.length === 1) {
                const d = dates[0];
                return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${d.getFullYear()}`;
            }

            let result = '';
            let currentMonth = dates[0].getMonth();
            let currentYear = dates[0].getFullYear();
            let daysInGroup = [];

            for (let i = 0; i < dates.length; i++) {
                const d = dates[i];
                if (d.getMonth() === currentMonth && d.getFullYear() === currentYear) {
                    daysInGroup.push(String(d.getDate()).padStart(2, '0'));
                } else {
                    // Month changed, format the previous group
                    let dayStr = daysInGroup.join(', ');
                    result += `${dayStr}/${String(currentMonth + 1).padStart(2, '0')}, `;
                    
                    // Start new group
                    currentMonth = d.getMonth();
                    currentYear = d.getFullYear();
                    daysInGroup = [String(d.getDate()).padStart(2, '0')];
                }
            }

            // Format the last group
            let dayStr = daysInGroup.join(' - ');
            result += `${dayStr}/${String(currentMonth + 1).padStart(2, '0')}/${currentYear}`;

            return result;
        }

        function printForm() {
            if (!validateAllFields()) return;
            
            const pmSubstituidoNome = document.getElementById('pmSubstituidoNome').value.toUpperCase();
            const pmSubstituidoId = document.getElementById('pmSubstituidoIdentificacao').value;
            const pmSubstitutoNome = document.getElementById('pmSubstitutoNome').value.toUpperCase();
            const pmSubstitutoId = document.getElementById('pmSubstitutoIdentificacao').value;
            const servicoPermutadoInicio = document.getElementById('dataServicoPermutadoInicio').value;
            const servicoPermutadoFim = document.getElementById('dataServicoPermutadoFim').value;
            const pagamentoInicio = document.getElementById('dataPagamentoServicoInicio').value;
            const pagamentoFim = document.getElementById('dataPagamentoServicoFim').value;
            const noPagamento = document.getElementById('noPagamentoCheckbox').checked;

            const localizacaoSede = '&nbsp;';
            const localizacaoTurilandia = '&nbsp;';
            const localizacaoTuriacu = 'X';
            
            const diasServico = servicoPermutadoInicio && servicoPermutadoFim ? Math.ceil((new Date(servicoPermutadoFim) - new Date(servicoPermutadoInicio)) / (1000 * 60 * 60 * 24)) + 1 : 0;
            let tipo24Horas = diasServico === 1 ? 'X' : '&nbsp;';
            let tipo48Horas = diasServico === 2 ? 'X' : '&nbsp;';
            let tipo72Horas = diasServico >= 3 ? 'X' : '&nbsp;';

            const servicoPermutadoTexto = formatarDataRange(servicoPermutadoInicio, servicoPermutadoFim);
            
            let pagamentoHtml = '';
            if (!noPagamento) {
                const pagamentoTexto = formatarDataRange(pagamentoInicio, pagamentoFim);
                pagamentoHtml = `<p class="text-base">Data do pagamento do serviço: ${pagamentoTexto}</p>`;
            }
            
            const brasaoUrlPrint = 'https://i.ibb.co/prs9KzDJ/BRAS-O.png';

            const printContent = `
                <!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><title>Formulário de Permuta - Impressão</title>
                <style>
                    body { font-family: 'Times New Roman', Times, serif; margin: 1.5cm; line-height: 1.15; font-size: 12pt; }
                    .container { width: 100%; max-width: 800px; margin: 0 auto; } .text-center { text-align: center; }
                    .font-bold { font-weight: bold; } p { margin: 4px 0; } .header p { margin: 2px 0; }
                    .text-sm { font-size: 11pt; } .text-xs { font-size: 9pt; } .text-base { font-size: 12pt; }
                </style></head><body>
                <div class="container">
                    <div class="text-center" style="line-height: 1.15; margin: 0;">
                        <img src="${brasaoUrlPrint}" alt="Brasão" style="width: 90px; height: 110px; display: block; margin: 0 auto 4px;">
                        <p class="font-bold" style="margin: 0;">ESTADO DO MARANHÃO</p>
                        <p class="text-sm" style="margin: 0;">SECRETARIA DE SEGURANÇA PÚBLICA</p>
                        <p class="text-sm" style="margin: 0;">CPA/I-5 – 10º BPM</p>
                        <p class="text-sm" style="margin: 0;">10º BATALHÃO DA POLÍCIA MILITAR DO MARANHÃO</p>
                        <p class="text-sm" style="margin: 0;">2ª COMPANHIA DO 10° BATALHÃO DE POLÍCIA MILITAR</p>
                        <p class="text-xs" style="margin: 0;">Rua Dr. Paulo Ramos, s/nº, Centro, Santa Helena - MA, Telefax: (98) 99243-6850 - Email: 2cia10bpm@gmail.com</p>
                        <p class="font-bold" style="margin-top: 2rem; margin-bottom: 0;">FORMULÁRIO DE AUTORIZAÇÃO PARA PERMUTA DE SERVIÇO</p>
                    </div>
                    <div class="mt-4 mb-4" style="margin-top: 1.5rem; margin-bottom: 1.5rem;">
                        <p class="text-base">SEDE: ( ${localizacaoSede} )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPM TURILÂNDIA: ( ${localizacaoTurilandia} )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPM TURIAÇU: ( ${localizacaoTuriacu} )</p>
                    </div>
                    <div style="margin-bottom: 0.25rem;">
                        <p class="text-base">PM SUBSTITUÍDO: ${pmSubstituidoNome} - ${pmSubstituidoId}</p>
                        <p style="margin-top: 4rem;">Assinatura:________________________________________</p>
                    </div>
                    <div style="margin-bottom: 0.25rem; margin-top: 1.5rem;">
                        <p class="text-base">PM SUBSTITUTO: ${pmSubstitutoNome} - ${pmSubstitutoId}</p>
                        <p style="margin-top: 4rem;">Assinatura:________________________________________</p>
                    </div>
                    <div class="mb-2" style="margin-top: 1.5rem;">
                        <p class="text-base">Data do serviço permutado: ${servicoPermutadoTexto}</p>
                        ${pagamentoHtml}
                    </div>
                    <div class="mb-4" style="text-align: left; margin-left: 20px; margin-top: 1rem;">
                        <p class="text-base">( ${tipo24Horas} ) 24 Horas - ( ${tipo48Horas} ) 48 Horas - ( ${tipo72Horas} ) 72 Horas</p>
                    </div>
                    <div class="text-center" style="margin-top: 2rem;">
                        <p class="text-base" style="margin: 0;">AUTORIZO A PERMUTA ENTRE OS POLICIAIS MILITARES ACIMA RELACIONADOS: ( &nbsp; ) Sim &nbsp; ( &nbsp; ) Não</p>
                        <p class="text-base" style="margin-top: 3rem; margin-bottom: 0;">_____________________________________________________</p>
                        <p class="text-base" style="margin-top: 0.2rem; margin-bottom: 0;">JOSE RIBAMAR BRAGA JUNIOR - 1º TEN QOPM</p>
                        <p class="text-sm" style="margin-top: 0;">COMANDANTE DA 2°CP/10°BPM</p>
                    </div>
                </div></body></html>`;

            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.onload = () => { printWindow.focus(); printWindow.print(); };
            } else {
                showCustomAlert('Erro de Pop-up', 'Por favor, habilite pop-ups para imprimir.');
            }
        }
        
        function signWithGovBr() {
            window.open('https://sso.acesso.gov.br/login?client_id=assinador.iti.br&authorization_id=198daa71163', '_blank');
        }

        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            populatePmSelects();
            renderCalendar(serviceCalendarState);
            renderCalendar(paymentCalendarState);
            noPagamentoCheckbox.checked = false; // Inicia desmarcada por padrão
            paymentContainer.classList.remove('hidden'); // Mostra o calendário de pagamento por padrão
        });
    </script>
</body>
</html>
